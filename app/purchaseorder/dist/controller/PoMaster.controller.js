sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/ui/model/Filter"],function(e,t,s){"use strict";return e.extend("sp.fiori.purchaseorder.controller.PoMaster",{onInit:function(){this.getView().addStyleClass("sapUiSizeCompact");this.router=sap.ui.core.UIComponent.getRouterFor(this);this._listTemp=this.getView().byId("listItemTemp").clone();this.flagModel=sap.ui.getCore().getModel("flagModel");this.oDataModel=sap.ui.getCore().getModel("oDataModel");this.filterModel=new sap.ui.model.json.JSONModel;this.router.attachRoutePatternMatched(this.handleRouteMatched,this)},handleRouteMatched:function(e){if(e.getParameter("name")!=="PoMaster"){return}var t=this;var s=sessionStorage.getItem("unitCode")||"P39";this.AddressCodePO=sessionStorage.getItem("AddressCodePO")||"GPL-01-01";if(t.flagModel.getData().confirmPressFlag){var i=this.getView().byId("masterListId").getSelectedItem();this.getView().byId("searchFieldId").setValue("");this.getView().byId("masterListId").getBinding("items").filter([]);this.getView().byId("masterListId").setSelectedItem(i,true);var r=t.getView().byId("masterListId");var a=i.getBindingContext().getProperty("PoNum");var d=a.replace(/\//g,"-");t.router.navTo("PoDetail",{Po_No:d});return}this.getView().byId("searchFieldId").setValue("");this.getView().byId("masterListId").bindItems({path:"/PurchaseOrders",parameters:{custom:{AddressCode:this.AddressCodePO,UnitCode:s},countMode:"None"},template:this._listTemp});this._getFirstItem()},_getFirstItem:function(){var e=this;sap.ui.core.BusyIndicator.show(0);this.getView().byId("masterListId").getBinding("items").attachDataReceived(function(){var t=e.getView().byId("masterListId");var s=t.getItems()[0];if(s){t.setSelectedItem(s,true);var i=sessionStorage.getItem("unitCode")||"P39";var r=s.getBindingContext().getProperty("PoNum");var a=r.replace(/\//g,"-");e.router.navTo("PoDetail",{Po_No:a,UnitCode:i});sap.ui.core.BusyIndicator.hide()}else{e.router.navTo("NoData")}sap.ui.core.BusyIndicator.hide()});sap.ui.core.BusyIndicator.hide()},onListItemPress:function(e){var t=sessionStorage.getItem("unitCode")||"P01";if(this.getView().byId("masterListId").getMode()=="MultiSelect"){return}var s=e.getParameter("listItem").getProperty("title");var i=s.replace(/\//g,"-");this.router.navTo("PoDetail",{Po_No:i,UnitCode:t})},onSearch:function(e){var t=sessionStorage.getItem("unitCode");if(e.getParameter("refreshButtonPressed")===true){this.getView().byId("masterListId").getBinding("items").refresh(true);this._getFirstItem()}else{var s=e.getParameter("query");if(s){this.getView().byId("masterListId").bindItems({path:"/PurchaseOrders?search="+s,parameters:{custom:{AddressCode:this.AddressCodePO,UnitCode:t}},template:this._listTemp})}else{this.getView().byId("masterListId").bindItems({path:"/PurchaseOrders",parameters:{custom:{AddressCode:this.AddressCodePO,UnitCode:t}},template:this._listTemp})}this._getFirstItem()}},onListModeChange:function(){var e=this.getView().byId("masterListId").getMode();if(e=="SingleSelectMaster"){this.getView().byId("masterListId").setMode("MultiSelect")}else{this.getView().byId("masterListId").setMode("SingleSelectMaster")}},onFilter:function(){if(!this.filterFragment){this.filterFragment=sap.ui.xmlfragment("sp.fiori.purchaseorder.fragment.filterFragment",this);this.filterFragment.setModel(this.filterModel,"filterModel")}this.filterVisibleModel=new sap.ui.model.json.JSONModel({Werks:true,Status:true});this.filterFragment.setModel(this.filterVisibleModel,"FilterVisibleModel");this.filterFragment.open()},onPlantValueHelp:function(){if(!this.PlantF4Frag){this.PlantF4Frag=sap.ui.xmlfragment("sp.fiori.purchaseorder.fragment.PlantFrag",this);this.PlantF4Temp=sap.ui.getCore().byId("plantTempId").clone()}this.PlantF4Frag.setModel(new t(JSON.parse(sessionStorage.getItem("CodeDetails"))),"plantModel");this.getView().addDependent(this.PlantF4Frag);sap.ui.getCore().byId("plantF4Id")._searchField.setVisible(false);this.PlantF4Frag.open()},handlePlantClose:function(e){var t=e.getParameter("selectedItem").getProperty("title");this.desc=e.getParameter("selectedItem").getProperty("description");this.filterModel.getData().Werks=t;this.filterModel.refresh("true");this.PlantF4Frag.destroy();this.PlantF4Frag=""},handlePlantCancel:function(){this.PlantF4Frag.destroy();this.PlantF4Frag=""},onFilterSubmit:function(){var e=this.filterModel.getData();this.AddressCodePO=sessionStorage.getItem("AddressCodePO")||"JSE-01-01";var t=e.Status;var s=e.Werks;if(!s){s=sessionStorage.getItem("unitCode")||"P01"}if(!t){this.getView().byId("masterListId").bindItems({path:"/PurchaseOrders",parameters:{custom:{AddressCode:this.AddressCodePO,UnitCode:s},countMode:"None"},template:this._listTemp})}else{this.getView().byId("masterListId").bindItems({path:"/PurchaseOrders?search="+t,parameters:{custom:{AddressCode:this.AddressCodePO,UnitCode:s}},template:this._listTemp})}if(e.Werks){this.PlantFilter=s+"("+this.desc+")";this.getView().byId("plantFilterId").setText(this.PlantFilter)}this.getView().byId("clearFilterId").setVisible(true);this.filterFragment.close();this.filterFragment.destroy();this.filterFragment="";this._getFirstItem()},onFilterCancel:function(){this.filterFragment.close();this.filterFragment.destroy();this.filterFragment=""},onFilterClear:function(){this.getView().byId("clearFilterId").setVisible(false);this.getView().byId("plantFilterId").setText("");var e=sessionStorage.getItem("unitCode")||"P01";this.AddressCodePO=sessionStorage.getItem("AddressCodePO")||"JSE-01-01";this.getView().byId("masterListId").bindItems({path:"/PurchaseOrders",parameters:{custom:{AddressCode:this.AddressCodePO,UnitCode:e},countMode:"None"},template:this._listTemp});this._getFirstItem()}})});